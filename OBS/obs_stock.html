
<!DOCTYPE html><html lang="en"><head>
<meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1">
<title>OBS Stock</title>
<link rel="stylesheet" href="assets/style.css">
<script defer src="assets/app.js"></script>
</head><body>
<div class="container">
  <div class="header">
    <div class="brand"><span class="dot"></span> OBS Stock</div>
    <div class="nav">
      <a href="index.html">Home</a>
      <a href="obs_index.html">Billing</a>
      <a href="obs_search.html">Search</a>
      <a href="#" id="logout">Logout</a>
    </div>
  </div>
  <div class="grid cols-2">
    <div class="card">
      <h2>Add / Edit Stock</h2>
      <div class="grid">
        <input id="code" placeholder="Item Code">
        <input id="name" placeholder="Item Name">
        <input id="rate" placeholder="Rate" type="number" step="0.01">
        <button class="btn" id="save">Save Item</button>
      </div>
      <p class="small">Scan or type Item Code. Codes link items to billing auto-fill.</p>
    </div>
    <div class="card">
      <h2>Stock Items</h2>
      <input id="sfilter" placeholder="Filter by name/code">
      <div style="max-height:420px;overflow:auto;margin-top:10px">
      <table class="table" id="stable">
        <thead><tr><th>Code</th><th>Name</th><th class="right">Rate</th><th class="right">Actions</th></tr></thead>
        <tbody></tbody>
      </table>
      </div>
    </div>
  </div>
  <footer>Â© <span id="y"></span> OBS. All rights reserved.</footer>
</div>
<script>
const session = requireAuth();
document.getElementById('y').textContent = new Date().getFullYear();
document.getElementById('logout').onclick = logout;
function render(){
  const q = sfilter.value.trim().toLowerCase();
  const tbody = document.querySelector('#stable tbody'); tbody.innerHTML='';
  getStock().filter(i=> !q || i.name.toLowerCase().includes(q) || i.code.toLowerCase().includes(q))
    .forEach(i=>{
      const tr = document.createElement('tr');
      tr.innerHTML = `<td>${i.code}</td><td>${i.name}</td><td class="right">${money(i.rate)}</td>
      <td class="right">
        <button class="btn secondary" data-edit="${i.code}">Edit</button>
        <button class="btn danger" data-del="${i.code}">Delete</button></td>`;
      tbody.appendChild(tr);
    });
}
render();
sfilter.oninput = render;
document.getElementById('save').onclick = ()=>{
  const item = {code: code.value.trim(), name: name.value.trim(), rate: Number(rate.value)};
  if(!item.code || !item.name || !item.rate){ toast('Fill all fields','error'); return; }
  upsertStock(item); toast('Saved','success'); render();
  code.value = name.value = rate.value = '';
};
document.querySelector('#stable').onclick = (e)=>{
  const ed = e.target.getAttribute('data-edit'); const dl = e.target.getAttribute('data-del');
  if(ed){
    const item = findStockByCode(ed); if(item){ code.value=item.code; name.value=item.name; rate.value=item.rate; }
  }
  if(dl){
    if(confirm('Delete item '+dl+'?')){ deleteStock(dl); render(); toast('Deleted','success'); }
  }
};
</script>
</body></html>
